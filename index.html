<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Upload Test</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #0a0a0a;
    color: white;
    font-family: Arial, sans-serif;
    padding: 20px;
    min-height: 100vh;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: #1a1a1a;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(196, 126, 44, 0.3);
    border: 2px solid #C47E2C;
}

h1 {
    color: #C47E2C;
    text-align: center;
    margin-bottom: 30px;
    font-size: 2rem;
}

.upload-area {
    border: 3px dashed #C47E2C;
    border-radius: 10px;
    padding: 50px;
    text-align: center;
    cursor: pointer;
    margin-bottom: 20px;
    transition: all 0.3s;
    background: rgba(196, 126, 44, 0.05);
}

.upload-area:hover {
    background: rgba(196, 126, 44, 0.1);
}

.upload-area.dragover {
    background: rgba(196, 126, 44, 0.2);
    border-color: #e6b851;
}

.upload-icon {
    font-size: 48px;
    margin-bottom: 15px;
    color: #C47E2C;
}

.upload-area h3 {
    margin-bottom: 10px;
    color: white;
}

.upload-area p {
    color: #aaa;
    font-size: 14px;
}

.file-info {
    background: #2a2a2a;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    display: none;
}

.file-info.show {
    display: block;
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #333;
}

.info-row:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.info-label {
    color: #aaa;
}

.info-value {
    color: white;
    font-weight: bold;
}

.audio-preview {
    margin-top: 20px;
}

.audio-preview audio {
    width: 100%;
    margin-top: 10px;
}

.controls {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    flex: 1;
    min-width: 120px;
}

.btn-primary {
    background: linear-gradient(135deg, #C47E2C, #9C5E1C);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(196, 126, 44, 0.4);
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-secondary {
    background: linear-gradient(135deg, #2a5c8c, #1a4c7c);
    color: white;
}

.message {
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    display: none;
}

.message.success {
    background: rgba(76, 175, 80, 0.1);
    border-left: 4px solid #4CAF50;
    color: #4CAF50;
    display: block;
}

.message.error {
    background: rgba(244, 67, 54, 0.1);
    border-left: 4px solid #F44336;
    color: #F44336;
    display: block;
}

.message.warning {
    background: rgba(255, 152, 0, 0.1);
    border-left: 4px solid #FF9800;
    color: #FF9800;
    display: block;
}

#fileInput {
    display: none;
}

.supported-formats {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    justify-content: center;
    margin-top: 10px;
}

.format-badge {
    background: rgba(42, 92, 140, 0.2);
    color: #aaa;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    border: 1px solid rgba(42, 92, 140, 0.3);
}

.format-badge.primary {
    background: rgba(196, 126, 44, 0.2);
    border-color: rgba(196, 126, 44, 0.3);
    color: #C47E2C;
}

.status {
    text-align: center;
    margin-top: 20px;
    color: #4CAF50;
    font-weight: bold;
}

@media (max-width: 600px) {
    .container {
        padding: 20px;
    }
    
    .upload-area {
        padding: 30px;
    }
    
    .controls {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
    }
}
</style>
</head>
<body>
<div class="container">
    <h1>üéµ Audio Upload Test</h1>
    
    <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìÅ</div>
        <h3>Click here or drag & drop any audio file</h3>
        <p>Maximum file size: 50MB</p>
        
        <div class="supported-formats">
            <span class="format-badge primary">MP3</span>
            <span class="format-badge primary">WAV</span>
            <span class="format-badge">M4A</span>
            <span class="format-badge">OGG</span>
            <span class="format-badge">FLAC</span>
            <span class="format-badge">AAC</span>
            <span class="format-badge">AIFF</span>
        </div>
        
        <input type="file" id="fileInput" accept="audio/*">
    </div>
    
    <div class="message" id="message"></div>
    
    <div class="file-info" id="fileInfo">
        <div class="info-row">
            <span class="info-label">File Name:</span>
            <span class="info-value" id="fileName">-</span>
        </div>
        <div class="info-row">
            <span class="info-label">File Size:</span>
            <span class="info-value" id="fileSize">-</span>
        </div>
        <div class="info-row">
            <span class="info-label">Duration:</span>
            <span class="info-value" id="fileDuration">-</span>
        </div>
        <div class="info-row">
            <span class="info-label">Format:</span>
            <span class="info-value" id="fileFormat">-</span>
        </div>
    </div>
    
    <div class="audio-preview" id="audioPreview" style="display: none;">
        <h4>Audio Preview:</h4>
        <audio id="audioPlayer" controls></audio>
    </div>
    
    <div class="controls">
        <button class="btn btn-primary" id="playBtn" disabled>‚ñ∂ Play</button>
        <button class="btn btn-secondary" id="pauseBtn" disabled>‚è∏ Pause</button>
        <button class="btn btn-secondary" id="stopBtn" disabled>‚èπ Stop</button>
        <button class="btn btn-secondary" id="loopBtn" disabled>‚Üª Loop</button>
        <button class="btn btn-primary" id="testBtn" disabled>üéµ Test Audio</button>
    </div>
    
    <div class="status" id="status">Ready to upload audio...</div>
</div>

<script>
// ======= SIMPLE AUDIO UPLOAD =======
let currentAudio = null;
let audioUrl = null;
let isLooping = false;

// Get DOM elements
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const audioPreview = document.getElementById('audioPreview');
const audioPlayer = document.getElementById('audioPlayer');
const messageEl = document.getElementById('message');
const statusEl = document.getElementById('status');

// Button elements
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const loopBtn = document.getElementById('loopBtn');
const testBtn = document.getElementById('testBtn');

// File info elements
const fileNameEl = document.getElementById('fileName');
const fileSizeEl = document.getElementById('fileSize');
const fileDurationEl = document.getElementById('fileDuration');
const fileFormatEl = document.getElementById('fileFormat');

// ======= EVENT LISTENERS =======
// Click upload area
uploadArea.addEventListener('click', () => {
    console.log('Upload area clicked');
    fileInput.click();
});

// File input change
fileInput.addEventListener('change', (e) => {
    console.log('File input changed');
    if (e.target.files.length > 0) {
        handleFileUpload(e.target.files[0]);
    }
});

// Drag and drop events
uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    
    if (e.dataTransfer.files.length > 0) {
        const file = e.dataTransfer.files[0];
        if (file.type.startsWith('audio/') || file.name.match(/\.(mp3|wav|m4a|ogg|flac|aac|aiff)$/i)) {
            console.log('File dropped:', file.name);
            handleFileUpload(file);
        } else {
            showMessage('Please drop an audio file (MP3, WAV, M4A, etc.)', 'error');
        }
    }
});

// Play button
playBtn.addEventListener('click', () => {
    if (audioPlayer.src) {
        audioPlayer.play().catch(e => {
            showMessage('Error playing audio: ' + e.message, 'error');
        });
        playBtn.textContent = '‚ñ∂ Playing';
    }
});

// Pause button
pauseBtn.addEventListener('click', () => {
    audioPlayer.pause();
    playBtn.textContent = '‚ñ∂ Play';
});

// Stop button
stopBtn.addEventListener('click', () => {
    audioPlayer.pause();
    audioPlayer.currentTime = 0;
    playBtn.textContent = '‚ñ∂ Play';
});

// Loop button
loopBtn.addEventListener('click', () => {
    isLooping = !isLooping;
    audioPlayer.loop = isLooping;
    loopBtn.textContent = isLooping ? '‚Üª Looping' : '‚Üª Loop';
    showMessage(isLooping ? 'Loop enabled' : 'Loop disabled', 'success');
});

// Test button - create test tone
testBtn.addEventListener('click', createTestTone);

// ======= FILE UPLOAD HANDLER =======
function handleFileUpload(file) {
    console.log('Starting file upload:', file.name);
    
    // Clear previous
    if (audioUrl) {
        URL.revokeObjectURL(audioUrl);
        audioUrl = null;
    }
    
    // Reset UI
    fileInfo.classList.remove('show');
    audioPreview.style.display = 'none';
    hideMessage();
    statusEl.textContent = 'Loading file...';
    
    // Validate file
    if (!file.type.startsWith('audio/') && !file.name.match(/\.(mp3|wav|m4a|ogg|flac|aac|aiff|webm)$/i)) {
        showMessage('Please select a valid audio file', 'error');
        statusEl.textContent = 'Invalid file type';
        return;
    }
    
    // File size check
    const maxSize = 50 * 1024 * 1024; // 50MB
    if (file.size > maxSize) {
        showMessage(`File too large (${formatFileSize(file.size)}). Maximum size is 50MB.`, 'error');
        statusEl.textContent = 'File too large';
        return;
    }
    
    // Create Object URL
    try {
        audioUrl = URL.createObjectURL(file);
        console.log('Created object URL:', audioUrl);
        
        // Set audio player source
        audioPlayer.src = audioUrl;
        
        // Wait for audio to load metadata
        audioPlayer.onloadedmetadata = () => {
            console.log('Audio metadata loaded');
            updateFileInfo(file);
            enableControls();
            statusEl.textContent = 'File loaded successfully!';
            showMessage('‚úÖ Audio file loaded successfully!', 'success');
        };
        
        audioPlayer.onerror = (e) => {
            console.error('Audio loading error:', e);
            showMessage('Error loading audio file. The file may be corrupted or in an unsupported format.', 'error');
            statusEl.textContent = 'Error loading file';
            disableControls();
        };
        
        audioPlayer.load(); // Start loading the audio
        
    } catch (error) {
        console.error('Error creating object URL:', error);
        showMessage('Error processing file: ' + error.message, 'error');
        statusEl.textContent = 'Error processing file';
    }
}

// ======= UPDATE FILE INFO =======
function updateFileInfo(file) {
    fileNameEl.textContent = file.name;
    fileSizeEl.textContent = formatFileSize(file.size);
    
    // Get file extension
    const extension = file.name.split('.').pop().toUpperCase();
    const mimeType = file.type || 'Unknown';
    fileFormatEl.textContent = `${extension} (${mimeType})`;
    
    // Duration will be updated by audioPlayer.onloadedmetadata
    audioPlayer.onloadedmetadata = () => {
        fileDurationEl.textContent = formatTime(audioPlayer.duration);
        fileInfo.classList.add('show');
        audioPreview.style.display = 'block';
        statusEl.textContent = `Loaded: ${formatTime(audioPlayer.duration)} audio`;
    };
}

// ======= ENABLE/DISABLE CONTROLS =======
function enableControls() {
    playBtn.disabled = false;
    pauseBtn.disabled = false;
    stopBtn.disabled = false;
    loopBtn.disabled = false;
    testBtn.disabled = false;
}

function disableControls() {
    playBtn.disabled = true;
    pauseBtn.disabled = true;
    stopBtn.disabled = true;
    loopBtn.disabled = true;
    testBtn.disabled = true;
}

// ======= TEST FUNCTION =======
function createTestTone() {
    // Create a simple test tone using Web Audio API
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 440; // A4 note
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
        
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 1); // Play for 1 second
        
        showMessage('üéµ Test tone played (440Hz sine wave)', 'success');
        
    } catch (error) {
        showMessage('Error creating test tone: ' + error.message, 'error');
    }
}

// ======= UTILITY FUNCTIONS =======
function showMessage(text, type = 'info') {
    messageEl.textContent = text;
    messageEl.className = `message ${type}`;
    messageEl.style.display = 'block';
    
    // Auto-hide success messages after 5 seconds
    if (type === 'success') {
        setTimeout(hideMessage, 5000);
    }
}

function hideMessage() {
    messageEl.style.display = 'none';
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function formatTime(seconds) {
    if (isNaN(seconds) || seconds === Infinity) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// ======= INITIALIZE =======
console.log('Audio Upload Test initialized');
statusEl.textContent = 'Ready - Click or drag audio file to upload';

// Clean up on page unload
window.addEventListener('beforeunload', () => {
    if (audioUrl) {
        URL.revokeObjectURL(audioUrl);
    }
});
</script>
</body>
</html>
